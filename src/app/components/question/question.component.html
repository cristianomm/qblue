<div class="bg-white p-6 rounded-lg shadow-md" [class.border-l-4]="isMarked" [class.border-yellow-400]="isMarked">
  <h3 class="text-xl font-semibold text-gray-800 mb-1">
    {{ questionData.question }}
    <span *ngIf="isMarked" class="text-sm text-yellow-600 font-normal ml-2">(Marcada)</span>
  </h3>
  <p class="text-gray-700 mb-4">{{ questionData.text }}</p>

  <ul class="space-y-3">
    <li *ngFor="let opt of questionData.options" class="block">
      <ng-container *ngFor="let kv of (opt | keyvalue)">
        <label
          class="flex items-center p-3 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors cursor-pointer"
          [class.bg-blue-50]="questionData.optiontype==='unique' ? currentAnswer === kv.key : currentAnswer?.includes(kv.key)"
        >
          <input
            [type]="questionData.optiontype==='unique' ? 'radio' : 'checkbox'"
            [attr.name]="questionData.optiontype === 'unique' ? 'question-' + questionData.id : null"
            [value]="$any(kv.key)"
            [checked]="questionData.optiontype==='unique' ? currentAnswer === kv.key : currentAnswer?.includes(kv.key)"
            (change)="onChange($any(kv.key))"
            [class.form-radio]="questionData.optiontype === 'unique'"
            [class.form-checkbox]="questionData.optiontype === 'multiple'"
            class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 mr-3"
          />
          <span class="text-gray-700 flex-1">
            <ng-container *ngFor="let segment of renderOptionTextWithLink(kv.value)">
              <span *ngIf="segment.type === 'text'">{{ segment.content }}</span>
              <a *ngIf="segment.type === 'link'" 
                 [href]="segment.url" 
                 target="_blank" 
                 rel="noopener noreferrer" 
                 class="text-blue-500 hover:underline">
                {{ segment.url }}
              </a>
            </ng-container>
          </span>
        </label>
      </ng-container>
    </li>
  </ul>

  <div *ngIf="questionData.topics?.length" class="mt-4 pt-3 border-t border-gray-200">
    <strong class="text-sm text-gray-600">TÃ³picos:</strong>
    <div class="flex flex-wrap gap-2 mt-1">
      <span *ngFor="let t of questionData.topics" class="bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs">
        {{ t }}
      </span>
    </div>
  </div>
</div>

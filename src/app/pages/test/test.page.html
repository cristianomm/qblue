<div *ngIf="questions.length" class="max-w-3xl mx-auto p-4 sm:p-6">
  <button (click)="showExit=true" class="mb-4 px-3 py-1.5 bg-red-500 text-white rounded-md">Sair</button>
  <app-timer 
    [timeLeft]="timeLeft" 
    [setTimeLeft]="setTimeLeft.bind(this)"
    (timeUp)="onTimeUp()">
  </app-timer>
  <app-header-stats
    [totalQuestions]="questions.length"
    [answeredQuestions]="answeredCount"
    [notAnsweredCount]="notAnsweredCount">
  </app-header-stats>
  <app-question
    [questionData]="questions[currentIndex]"
    [currentAnswer]="userAnswers[questions[currentIndex].id]"
    [isMarked]="markedForLater.includes(questions[currentIndex].id)"
    (answerSelect)="onAnswerSelect($event)">
  </app-question>
  <div class="mt-8 flex space-x-3 justify-center">
    <button
      (click)="navigate(-1)"
      [disabled]="currentIndex===0"
      class="px-3 py-1.5 bg-blue-600 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed">
      Anterior
    </button>
    <button
      (click)="markLater()"
      class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
      {{ markedForLater.includes(questions[currentIndex].id) ? 'Desmarcar' : 'Marcar p/ Depois' }}
    </button>
    <button
      *ngIf="currentIndex<questions.length-1"
      (click)="navigate(1)"
      class="px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700">
      Próxima
    </button>
    <button
      *ngIf="currentIndex===questions.length-1"
      (click)="showFinish=true"
      class="px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700">
      Finalizar Teste
    </button>
  </div>
</div>

<app-modal
  *ngIf="showFinish"
  title="Finalizar Teste?"
  message="Deseja finalizar?"
  (confirm)="finalize()"
  (cancel)="showFinish=false">
</app-modal>

<app-modal
  *ngIf="showExit"
  title="Sair do Teste?"
  message="Progresso será perdido."
  (confirm)="confirmExit()"
  (cancel)="showExit=false">
</app-modal>

<app-modal
  *ngIf="showTimeUp"
  title="Tempo Esgotado!"
  message="O tempo para este teste acabou. Você será redirecionado para a página de resultados."
  [showCancel]="false"
  confirmText="OK"
  (confirm)="showTimeUp=false">
</app-modal>

<div *ngIf="!questions.length" class="text-center p-10">
  Carregando questões...
</div>
